<Page
    x:Class="MindCanvas.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MindCanvas"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*"/>
            <ColumnDefinition Width="6*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="1*"/>
            <RowDefinition Height="9*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Grid.Column="0" x:Name="MenuBtnBorder">
            <AppBarButton 
                x:Name="MenuBtn" 
                Label="菜单" 
                VerticalAlignment="Center" 
                HorizontalAlignment="Center"
                Click="MenuBtn_Click">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xEDE3;"/>
                </AppBarButton.Icon>
            </AppBarButton>
        </Border>

        <Border Grid.Row="0" Grid.Column="1" x:Name="AppBarButtonsBorder">
            <StackPanel
                Orientation="Horizontal" 
                HorizontalAlignment="Center"
                VerticalAlignment="Center">

                <AppBarButton Label="添加点" AllowFocusOnInteraction="True" Tapped="AddNodeBtn_Tapped">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="&#xE7C8;"/>
                    </AppBarButton.Icon>
                    <!--AppBarButton.Flyout有一个BUG，但要Windows UI 3.0 才能修复
                    所以用FlyoutBase.AttachedFlyout加一个AddNodeBtn_Tapped方法
                    详见 https://github.com/microsoft/microsoft-ui-xaml/issues/679-->
                    <FlyoutBase.AttachedFlyout>
                        <Flyout Placement="Bottom">
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="AddNodeTextBox" PlaceholderText="点名称" Margin="0,0,12,0" Width="150"/>
                                <Button Content="确定" Click="AddNodeBtn_Click"/>
                            </StackPanel>
                        </Flyout>
                    </FlyoutBase.AttachedFlyout>
                </AppBarButton>

                <AppBarToggleButton Label="连接点" 
                                    x:Name="TieBtn"
                                    Click="TieBtn_Click">
                    <AppBarToggleButton.Icon>
                        <!--<FontIcon Glyph="&#xF7B7;"/>-->
                        <FontIcon Glyph="&#xE71B;"/>
                    </AppBarToggleButton.Icon>
                </AppBarToggleButton>
                <AppBarSeparator/>

                <AppBarButton Icon="Undo" Label="撤销" IsEnabled="False" x:Name="UndoBtn" Click="UndoBtn_Click"/>
                <AppBarButton Icon="Redo" Label="重做" IsEnabled="False" x:Name="RedoBtn"  Click="RedoBtn_Click"/>

            </StackPanel>
        </Border>

        <Border Grid.Row="0" Grid.Column="2" x:Name="AppNameBorder">
            <TextBlock 
                x:Name="AppNameTextBlock" 
                VerticalAlignment="Center" 
                HorizontalAlignment="Center" 
                Style="{StaticResource TitleTextBlockStyle}"
                Text="MindCanvas"/>
        </Border>

        <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Canvas.ZIndex="-1">
            <ScrollViewer 
                x:Name="MindMapScrollViewer" 
                ZoomMode="Enabled"                 
                MinZoomFactor="0.4"
                MaxZoomFactor="2"
                VerticalScrollBarVisibility="Hidden" 
                HorizontalScrollBarVisibility="Hidden"
                ManipulationDelta="MindMapScrollViewer_ManipulationDelta"
                ManipulationMode="All">
                <!--https://social.msdn.microsoft.com/Forums/sqlserver/en-US/fa291e73-81d0-4977-b7be-c21b32f5c035/uwp-zoom-from-center-of-image-using-scroller-viewer-->
                <Border 
                    x:Name="MindMapBorder" 
                    Loaded="MindMapBorder_Loaded" />
            </ScrollViewer>
        </Border>

        <Border Grid.Row="1" Grid.Column="2" Background="{ThemeResource SystemControlAcrylicWindowBrush}">
            <ScrollViewer
                Padding="0,0,0,0"
                VerticalScrollBarVisibility="Auto"
                VerticalScrollMode="Auto">

                <StackPanel Orientation="Vertical" Margin="20,40,20,0">
                    <TextBlock  x:Name="InfoTextBlock" Text="从左侧选择一个元素以查看或编辑它。" HorizontalAlignment="Center" FontSize="16" TextWrapping="Wrap"/>
                    <StackPanel x:Name="NodeStackPanel" Orientation="Vertical" Visibility="Collapsed">
                        <StackPanel.ChildrenTransitions>
                            <TransitionCollection>
                                <ContentThemeTransition />
                            </TransitionCollection>
                        </StackPanel.ChildrenTransitions>

                        <TextBlock Text="点" Style="{StaticResource TitleTextBlockStyle}"/>
                        <Grid Margin="0,20,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="5*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="名称" Grid.Row="0" Grid.Column="0" FontSize="15" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            <TextBox x:Name="NodeName" Grid.Row="0" Grid.Column="1"/>
                        </Grid>
                        <Grid Margin="0,20,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="5*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="描述" Grid.Row="0" Grid.Column="0" FontSize="15" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            <TextBox x:Name="NodeDescription" Grid.Row="0" Grid.Column="1"/>
                        </Grid>
                        <Button Margin="0,20,0,0" HorizontalAlignment="Right" Content="修改" FontSize="15" Width="100" Click="ModifiedNodeBtn_Click"/>
                        <Button Margin="0,20,0,0" HorizontalAlignment="Right" Content="删除" FontSize="15" Width="100" Click="RemoveNodeBtn_Click"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>

    </Grid>
</Page>
